# 直播推流使用指南

本指南将帮助你将互动游戏页面推流到抖音直播间。

## 📺 推流方式

### 方式一：使用 OBS 推流（推荐）

OBS Studio 是一款功能强大的免费推流软件，支持多种推流方式。

#### 1. 安装 OBS Studio

下载并安装 OBS Studio：
- 官方网站：https://obsproject.com/
- 选择 Windows/Mac 版本下载安装

#### 2. 配置 OBS

1. **启动 OBS Studio**
   - 打开 OBS Studio

2. **添加场景**
   - 在"场景"区域点击 "+" 按钮
   - 创建一个新场景，命名为"互动游戏"

3. **添加浏览器源**
   - 在"来源"区域点击 "+" 按钮
   - 选择"浏览器"
   - 命名为"游戏页面"
   - 输入 URL：`http://localhost:5000/stream`
   - 设置宽度：1920
   - 设置高度：1080
   - 点击"确定"

4. **调整画面**
   - 右键点击"游戏页面"来源
   - 选择"变换" → "适应屏幕"

5. **设置推流参数**
   - 点击"设置"按钮
   - 进入"推流"标签页
   - 选择服务："自定义"
   - 服务器：从抖音直播伴侣获取推流地址
   - 串流密钥：从抖音直播伴侣获取推流密钥

#### 3. 开始推流

1. 点击"开始推流"按钮
2. OBS 开始将游戏画面推流到直播间

### 方式二：使用抖音直播伴侣

抖音直播伴侣是抖音官方的推流软件，简单易用。

#### 1. 下载安装

- 访问：https://live.douyin.com/tool
- 下载并安装抖音直播伴侣

#### 2. 配置直播伴侣

1. **登录账号**
   - 使用抖音账号登录直播伴侣

2. **创建直播间**
   - 点击"开始直播"按钮
   - 设置直播标题和封面

3. **添加窗口源**
   - 在"素材"区域点击"+"按钮
   - 选择"窗口" → "应用窗口"
   - 选择游戏页面所在的浏览器窗口

4. **调整画面**
   - 拖拽调整窗口位置和大小
   - 确保游戏页面清晰可见

5. **获取推流信息**
   - 在直播伴侣中获取推流地址和密钥
   - 这些信息将用于 OBS 或其他推流软件

#### 3. 开始直播

1. 点击"开始直播"按钮
2. 游戏页面将显示在直播间

### 方式三：使用浏览器窗口捕获

这是最简单的方式，适合不熟悉推流软件的用户。

#### 步骤

1. **打开游戏页面**
   - 在浏览器中打开：`http://localhost:5000/stream`

2. **全屏显示**
   - 按 F11 进入全屏模式
   - 或者使用浏览器的全屏功能

3. **开始直播**
   - 在抖音直播伴侣中
   - 选择"屏幕录制"或"窗口录制"
   - 选择浏览器窗口
   - 开始直播

## ⚙️ 推流设置建议

### OBS 推流设置

**视频设置**：
- 输出分辨率：1920x1080（1080p）或 1280x720（720p）
- 帧率：30 FPS 或 60 FPS
- 缩放方法：Bicubic（平滑缩放）

**音频设置**：
- 采样率：44.1kHz 或 48kHz
- 声道：立体声

**输出设置**：
- 输出模式：高级
- 码率：建议 3000-8000 Kbps（根据网络情况）
- 关键帧间隔：2秒
- 预设：质量

### 网络要求

- 上行带宽：至少 5 Mbps（1080p）或 3 Mbps（720p）
- 延迟：低于 100ms
- 稳定性：网络稳定，避免频繁掉线

## 🎨 画面优化

### 1. 分辨率设置

推流页面的默认分辨率为 1920x1080（16:9 比例）。

如需修改，可以编辑 `src/app/stream/page.tsx` 中的样式。

### 2. 背景设置

推流页面使用了渐变背景，如需修改：

```tsx
// 在 stream/page.tsx 中
<div className="fixed inset-0 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
```

### 3. 字体大小调整

根据推流分辨率，可以调整字体大小：

```tsx
// 例如：将观众人数的字体从 text-xl 改为 text-2xl
<span className="text-white text-2xl font-bold">{viewerCount.toLocaleString()}</span>
```

## 🎤 添加音频

### 添加麦克风音频

在 OBS 中：

1. 在"来源"区域点击"+"按钮
2. 选择"音频输入捕获"
3. 选择你的麦克风
4. 调整音量

### 添加背景音乐

在 OBS 中：

1. 在"来源"区域点击"+"按钮
2. 选择"媒体源"
3. 选择背景音乐文件
4. 勾选"循环"
5. 调整音量

## 🔧 常见问题

### 1. 画面模糊

**原因**：码率过低或分辨率不匹配

**解决**：
- 提高推流码率（建议 3000-8000 Kbps）
- 确保源分辨率和输出分辨率一致
- 检查网络带宽

### 2. 画面卡顿

**原因**：网络不稳定或电脑性能不足

**解决**：
- 降低推流分辨率（从 1080p 改为 720p）
- 降低帧率（从 60 FPS 改为 30 FPS）
- 关闭其他占用资源的程序
- 使用有线网络代替 WiFi

### 3. 音频不同步

**原因**：音频延迟设置不当

**解决**：
- 在 OBS 设置中调整音频同步偏移
- 检查麦克风延迟
- 使用音频监控功能

### 4. 浏览器源黑屏

**原因**：浏览器硬件加速问题

**解决**：
- 在 OBS 浏览器源设置中关闭"控制音频"
- 在浏览器中关闭硬件加速
- 尝试使用不同的浏览器

### 5. WebSocket 断开连接

**原因**：服务器连接问题

**解决**：
- 检查服务器是否正常运行
- 确认端口 5000 可以访问
- 查看浏览器控制台错误信息

## 📱 移动端直播

如果需要在手机上直播：

### 使用投屏

1. 在电脑上打开游戏页面
2. 使用投屏软件将电脑画面投屏到手机
3. 在手机上使用抖音直播功能

### 使用推流软件

1. 在电脑上使用 OBS 推流
2. 在抖音直播伴侣中获取推流地址
3. 在 OBS 中配置推流参数
4. 开始推流

## 🎯 最佳实践

1. **提前测试**
   - 在正式直播前进行测试
   - 检查画面、声音、网络

2. **稳定网络**
   - 使用有线网络
   - 准备备用网络

3. **性能优化**
   - 关闭不必要的程序
   - 定期清理电脑

4. **互动引导**
   - 在直播中引导观众发送弹幕
   - 解释游戏规则和触发词

5. **应急预案**
   - 准备备用推流方案
   - 准备备用设备

## 📞 技术支持

如遇到问题，可以：

1. 查看项目文档
2. 提交 Issue
3. 联系技术支持

---

**提示**：推流模式页面专为直播设计，去除了所有多余元素，确保画面清晰、性能流畅。建议使用 OBS Studio 进行推流。
