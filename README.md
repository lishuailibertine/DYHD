# æŠ–éŸ³äº’åŠ¨æ¸¸æˆç³»ç»Ÿ - å®Œæ•´ç‰ˆ

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æŠ–éŸ³å¼¹å¹•äº’åŠ¨æ¸¸æˆç³»ç»Ÿï¼Œæ”¯æŒå®æ—¶ç›´æ’­å±•ç¤ºã€å¼¹å¹•äº’åŠ¨ã€ç¤¼ç‰©è§¦å‘ç­‰èƒ½åŠ›ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **å®æ—¶å¼¹å¹•äº’åŠ¨** - è§‚ä¼—å‘é€å¼¹å¹•è§¦å‘æ¸¸æˆæŠ€èƒ½
- âœ… **ç¤¼ç‰©ç³»ç»Ÿ** - ç¤¼ç‰©è§¦å‘ç‰¹æ®ŠæŠ€èƒ½æ•ˆæœï¼Œæ”¯æŒä»·å€¼å€ç‡
- âœ… **å¤šç§æŠ€èƒ½** - æ²»ç–—ã€æ”»å‡»ã€æŠ¤ç›¾ã€å¿…æ€æŠ€ï¼Œå¯è‡ªå®šä¹‰å‚æ•°
- âœ… **å®æ—¶é€šä¿¡** - WebSocket é•¿è¿æ¥ï¼Œä½å»¶è¿Ÿæ¨é€
- âœ… **ç›´æ’­å±•ç¤º** - ä¸“ä¸ºç›´æ’­é—´è®¾è®¡çš„æ²‰æµ¸å¼ç•Œé¢
- âœ… **æ¸¸æˆç®¡ç†** - å®Œæ•´çš„é…ç½®ç®¡ç†ç³»ç»Ÿ
- âœ… **äº‹ä»¶å¤„ç†** - æ”¯æŒå¼¹å¹•ã€ç¤¼ç‰©ã€ç‚¹èµã€å…³æ³¨ç­‰å¤šç§äº‹ä»¶

### æŠ€æœ¯äº®ç‚¹

- ğŸš€ **Next.js 16** - æœ€æ–°çš„ React æ¡†æ¶
- ğŸ¨ **shadcn/ui** - ç°ä»£åŒ– UI ç»„ä»¶åº“
- ğŸ”Œ **WebSocket** - å®æ—¶åŒå‘é€šä¿¡
- ğŸ” **ç­¾åéªŒè¯** - å®Œæ•´çš„å®‰å…¨æœºåˆ¶
- ğŸ“± **å“åº”å¼è®¾è®¡** - é€‚é…å„ç§å±å¹•
- âš¡ **é«˜æ€§èƒ½** - ä¼˜åŒ–çš„äº‹ä»¶å¤„ç†å’ŒåŠ¨ç”»

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env.local`ï¼š

```bash
cp .env.example .env.local
```

ç¼–è¾‘ `.env.local` å¡«å†™é…ç½®ï¼š

```env
DOUYIN_APP_ID=your_app_id
DOUYIN_APP_SECRET=your_app_secret
DOUYIN_ROOM_ID=your_room_id
GAME_ID=your_game_id
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:5000` å¯åŠ¨ã€‚

## ğŸ® ä½¿ç”¨æŒ‡å—

### é¡µé¢å¯¼èˆª

1. **ä¸»é¡µ** (`/`) - æ¸¸æˆæ¼”ç¤ºå’Œè¯´æ˜
2. **ç›´æ’­é—´** (`/live`) - ç›´æ’­å±•ç¤ºé¡µé¢
3. **ç®¡ç†åå°** (`/admin`) - æ¸¸æˆé…ç½®ç®¡ç†

### æ¸¸æˆç©æ³•

#### æŠ€èƒ½è§¦å‘è¯

| æŠ€èƒ½ | è§¦å‘è¯ | æ•ˆæœ | å†·å´ |
|------|--------|------|------|
| æ²»ç–—æœ¯ | æ²»ç–—ã€å›è¡€ã€å¥¶ä¸€å£ã€åŠ è¡€ | å›å¤200ç‚¹ç”Ÿå‘½å€¼ | 5ç§’ |
| æ™®é€šæ”»å‡» | æ”»å‡»ã€æ‰“ã€ç ã€æ | é€ æˆ(æ”»å‡»åŠ›-é˜²å¾¡)ç‚¹ä¼¤å®³ | 2ç§’ |
| ç¥åœ£æŠ¤ç›¾ | æŠ¤ç›¾ã€é˜²å¾¡ã€æ ¼æŒ¡ | æ ¼æŒ¡50%ä¼¤å®³ï¼ŒæŒç»­5ç§’ | 10ç§’ |
| ç»ˆæå¥¥ä¹‰ | å¿…æ€æŠ€ã€å¤§æ‹›ã€ç»æ‹› | é€ æˆ300%æ”»å‡»åŠ›çš„å·¨é¢ä¼¤å®³ | 30ç§’ |

#### ç¤¼ç‰©æ•ˆæœ

| ç¤¼ç‰©åç§° | æŠ€èƒ½ | å€ç‡ | è¯´æ˜ |
|---------|------|------|------|
| çˆ±å¿ƒ | æ²»ç–— | 1x | åŸºç¡€æ²»ç–— |
| 666 | æ”»å‡» | 1x | åŸºç¡€æ”»å‡» |
| ç«ç‘° | æ²»ç–— | 2x | ä¸­çº§æ²»ç–— |
| è·‘è½¦ | å¿…æ€æŠ€ | 5x | å¼ºåŠ›æ”»å‡» |
| ç«ç®­ | å¿…æ€æŠ€ | 10x | ç»ˆææ”»å‡» |

ç¤¼ç‰©æ•ˆæœè®¡ç®—å…¬å¼ï¼š
```
æ€»å€ç‡ = åŸºç¡€å€ç‡ Ã— æ•°é‡å€ç‡ Ã— ä»·å€¼å€ç‡
æ•°é‡å€ç‡ = log10(æ•°é‡ + 1)
ä»·å€¼å€ç‡ = log10(ä»·å€¼ + 1)
```

## ğŸ”§ é…ç½®ç®¡ç†

### åŸºç¡€é…ç½®

- **ç›´æ’­é—´ ID** - æŠ–éŸ³ç›´æ’­é—´å”¯ä¸€æ ‡è¯†
- **æ¸¸æˆ ID** - æ¸¸æˆé…ç½®ID
- **æ¸¸æˆæ—¶é•¿** - å•å±€æ¸¸æˆæ—¶é•¿ï¼ˆç§’ï¼‰

### è§’è‰²é…ç½®

- **ç©å®¶å±æ€§** - åç§°ã€ç”Ÿå‘½å€¼ã€æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›
- **æ•Œäººå±æ€§** - åç§°ã€ç”Ÿå‘½å€¼ã€æ”»å‡»åŠ›ã€é˜²å¾¡åŠ›

### æŠ€èƒ½é…ç½®

æ¯ä¸ªæŠ€èƒ½å¯é…ç½®ï¼š
- å¯ç”¨/ç¦ç”¨
- å†·å´æ—¶é—´
- æ•ˆæœå€¼
- å€ç‡

## ğŸ“¡ API æ¥å£

### 1. Webhook æ¥å£

**åœ°å€**: `POST /api/douyin/webhook`

**è¯·æ±‚æ ¼å¼**:

```json
{
  "event_type": "danmaku",
  "data": {
    "room_id": "ç›´æ’­é—´ID",
    "user_id": "ç”¨æˆ·ID",
    "user_name": "ç”¨æˆ·æ˜µç§°",
    "content": "å¼¹å¹•å†…å®¹",
    "timestamp": 1234567890
  },
  "sign": "ç­¾å"
}
```

**æ”¯æŒçš„äº‹ä»¶ç±»å‹**:
- `danmaku` - å¼¹å¹•
- `gift` - ç¤¼ç‰©
- `like` - ç‚¹èµ
- `follow` - å…³æ³¨
- `enter_room` - è¿›å…¥æˆ¿é—´
- `exit_room` - ç¦»å¼€æˆ¿é—´

### 2. WebSocket æ¥å£

**åœ°å€**: `ws://localhost:5000/api/ws`

**è¿æ¥**:

```javascript
const ws = new WebSocket('ws://localhost:5000/api/ws');

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  // å¤„ç†æ¶ˆæ¯
};
```

**æ¶ˆæ¯æ ¼å¼**:

```json
{
  "type": "event",
  "data": {
    "type": "danmaku",
    "data": {
      "user_id": "ç”¨æˆ·ID",
      "user_name": "ç”¨æˆ·æ˜µç§°",
      "content": "å¼¹å¹•å†…å®¹",
      "skill_type": "heal",
      "timestamp": 1234567890
    }
  }
}
```

## ğŸ¯ å¯¹æ¥æŠ–éŸ³å¼€æ”¾å¹³å°

### 1. æ³¨å†Œå¼€å‘è€…è´¦å·

è®¿é—® [æŠ–éŸ³å¼€æ”¾å¹³å°](https://developer.open-douyin.com/) æ³¨å†Œå¼€å‘è€…è´¦å·ã€‚

### 2. åˆ›å»ºåº”ç”¨

1. ç™»å½•åè¿›å…¥ã€Œåº”ç”¨ç®¡ç†ã€
2. ç‚¹å‡»ã€Œåˆ›å»ºåº”ç”¨ã€
3. é€‰æ‹©åº”ç”¨ç±»å‹ï¼šç½‘é¡µåº”ç”¨
4. å¡«å†™åº”ç”¨ä¿¡æ¯

### 3. è·å–å‡­è¯

åˆ›å»ºåº”ç”¨åè·å¾—ï¼š
- **App ID** - åº”ç”¨å”¯ä¸€æ ‡è¯†
- **App Secret** - åº”ç”¨å¯†é’¥ï¼ˆè¯·å¦¥å–„ä¿ç®¡ï¼‰

### 4. é…ç½® Webhook

åœ¨åº”ç”¨é…ç½®ä¸­è®¾ç½®å›è°ƒåœ°å€ï¼š

```
POST https://your-domain.com/api/douyin/webhook
```

è¦æ±‚ï¼š
- æ”¯æŒ HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- å“åº”æ—¶é—´ < 3ç§’
- è¿”å› HTTP 200

### 5. éªŒè¯ç­¾å

ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯æ‰€æœ‰è¯·æ±‚çš„ç­¾åï¼Œç¡®ä¿æ¶ˆæ¯å®‰å…¨ã€‚

### è¯¦ç»†æ–‡æ¡£

è¯·æŸ¥çœ‹ `docs/douyin-integration-guide.md` è·å–å®Œæ•´çš„å¯¹æ¥æŒ‡å—ã€‚

## ğŸ§ª æµ‹è¯•å·¥å…·

### 1. åœ¨çº¿æµ‹è¯•é¡µé¢

è®¿é—® `http://localhost:5000/test.html` ä½¿ç”¨åœ¨çº¿æµ‹è¯•å·¥å…·ã€‚

### 2. API æµ‹è¯•

ä½¿ç”¨ curl æµ‹è¯• Webhook æ¥å£ï¼š

```bash
curl -X POST -H "Content-Type: application/json" \
  -d '{
    "event_type": "danmaku",
    "data": {
      "user_id": "test001",
      "user_name": "æµ‹è¯•ç”¨æˆ·",
      "content": "æ²»ç–—",
      "timestamp": 1234567890
    },
    "sign": "test"
  }' \
  http://localhost:5000/api/douyin/webhook
```

### 3. WebSocket æµ‹è¯•

ä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•ï¼š

```javascript
const ws = new WebSocket('ws://localhost:5000/api/ws');
ws.onmessage = (event) => console.log(JSON.parse(event.data));
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ douyin/
â”‚   â”‚   â”‚       â””â”€â”€ webhook/
â”‚   â”‚   â”‚           â””â”€â”€ route.ts          # Webhook æ¥å£
â”‚   â”‚   â”œâ”€â”€ live/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                  # ç›´æ’­å±•ç¤ºé¡µé¢
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                  # ç®¡ç†åå°
â”‚   â”‚   â”œâ”€â”€ page.tsx                      # ä¸»é¡µ
â”‚   â”‚   â””â”€â”€ ws/
â”‚   â”‚       â””â”€â”€ route.ts                  # WebSocket æ¥å£
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ douyin-auth.ts                # è®¤è¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ douyin-game.ts                # æ¸¸æˆæœåŠ¡
â”‚   â””â”€â”€ components/ui/                    # shadcn/ui ç»„ä»¶
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ douyin-integration-guide.md       # å¯¹æ¥æŒ‡å—
â”œâ”€â”€ public/
â”‚   â””â”€â”€ test.html                         # æµ‹è¯•å·¥å…·
â”œâ”€â”€ server.js                             # WebSocket æœåŠ¡å™¨
â”œâ”€â”€ .env.example                          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ package.json
```

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### ä¸»é¡µ
- æ¸¸æˆæ¼”ç¤º
- åŠŸèƒ½è¯´æ˜
- å¿«é€Ÿå…¥å£

### ç›´æ’­é¡µé¢
- è§’è‰²é¢æ¿
- æˆ˜æ–—åœºæ™¯
- å®æ—¶å¼¹å¹•
- æˆ˜æ–—æ—¥å¿—
- æŠ€èƒ½å±•ç¤º

### ç®¡ç†åå°
- æ¸¸æˆé…ç½®
- è§’è‰²è®¾ç½®
- æŠ€èƒ½å‚æ•°
- æ¸¸æˆæ§åˆ¶

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ç¯å¢ƒå˜é‡** - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
2. **HTTPS** - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS
3. **ç­¾åéªŒè¯** - å¯ç”¨ç­¾åéªŒè¯ç¡®ä¿è¯·æ±‚å®‰å…¨
4. **é™æµ** - å®ç°æ¥å£é™æµé˜²æ­¢æ»¥ç”¨
5. **æ—¥å¿—** - è®°å½•æ‰€æœ‰è¯·æ±‚ä¾¿äºæ’æŸ¥é—®é¢˜

## ğŸš€ éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ

```bash
pnpm dev
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
pnpm build
pnpm start
```

### Docker éƒ¨ç½²

```bash
docker build -t douyin-game .
docker run -p 5000:5000 douyin-game
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ WebSocket å®ç°å®æ—¶é€šä¿¡
- ä¼˜åŒ–åŠ¨ç”»æ€§èƒ½ï¼ˆä½¿ç”¨ CSS transformï¼‰
- è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§é‡å¼¹å¹•
- æ‡’åŠ è½½éå…³é”®èµ„æº
- CDN åŠ é€Ÿé™æ€èµ„æº

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ“ è”ç³»æ–¹å¼

- æŠ€æœ¯æ”¯æŒé‚®ç®±ï¼štech-support@example.com
- é¡¹ç›®æ–‡æ¡£ï¼šhttps://github.com/your-repo
- å¼€å‘è€…ç¤¾åŒºï¼šhttps://community.example.com

---

**æ³¨æ„**ï¼šæœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ å’Œæ¼”ç¤ºä½¿ç”¨ï¼Œå®é™…å¯¹æ¥æŠ–éŸ³å¼€æ”¾å¹³å°æ—¶ï¼Œè¯·éµå®ˆæŠ–éŸ³å¼€æ”¾å¹³å°çš„ä½¿ç”¨è§„èŒƒå’Œæ¡æ¬¾ã€‚
